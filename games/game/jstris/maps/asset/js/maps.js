window.addEventListener("load",(function(){for(var t=document.getElementsByClassName("vote"),e=0;e<t.length;e++){if(void 0!==t[e].dataset.vote){var s=t[e].dataset.vote;1==s?showUp(t[e]):-1==s&&showDown(t[e])}t[e].children[0].addEventListener("click",upvote),t[e].children[2].addEventListener("click",downvote)}}));var generalStop=!1;function upvote(){1!=this.parentNode.dataset.vote&&(showUp(this.parentNode),this.parentNode.dataset.vote=1,vote(this.parentNode,1))}function downvote(){-1!=this.parentNode.dataset.vote&&(showDown(this.parentNode),this.parentNode.dataset.vote=-1,vote(this.parentNode,-1))}function vote(t,e){if(!generalStop){var s=t.dataset.id,o=document.head.querySelector("[name=csrf-token]").content,i=new XMLHttpRequest,c="";"undefined"!=typeof vote_sub&&(c="&sub="+vote_sub);var n="id="+s+"&vote="+e+c;i.timeout=6e3,i.open("POST","/maps/vote",!0),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.setRequestHeader("X-CSRF-TOKEN",o),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.send(n),i.onload=function(){200===i.status&&processResponse(t,i.responseText)}}}function processResponse(t,e){var s=JSON.parse(e);if(1===s.status)1===s.type?showUp(t):showDown(t),changeCount(t,s.change);else{var o=null;3===t.children.length?((o=document.createElement("div")).classList.add("err"),t.appendChild(o)):o=t.children[3],o.innerHTML=s.err,generalStop=!0}}function showUp(t){t.children[0].classList.add("active"),t.children[2].classList.remove("active")}function showDown(t){t.children[0].classList.remove("active"),t.children[2].classList.add("active")}function changeCount(t,e){var s=parseInt(t.children[1].innerHTML);t.children[1].innerHTML=s+e}function sprintTimeFormat(t,e){if(t<60&&e>0)return t.toFixed(e);var s=Math.floor(t/60),o=(t-=60*s).toFixed(e<0?0:e);return s+":"+(parseInt(o)<10?"0":"")+o}function getParameterByName(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))}function getKeyByValue(t,e){for(var s in t)if(t.hasOwnProperty(s)&&t[s]===e)return s}function _simpleArrayBufferToBase64(t){for(var e="",s=new Uint8Array(t),o=s.byteLength,i=0;i<o;i++)e+=String.fromCharCode(s[i]);return window.btoa(e)}function base64ToBinary(t){for(var e=window.atob(t),s=e.length,o=new Uint8Array(new ArrayBuffer(s)),i=0;i<s;i++)o[i]=e.charCodeAt(i);return o}function objSize(t){var e,s=0;for(e in t)t.hasOwnProperty(e)&&s++;return s}function objCopy(t){if(null==t||"object"!=typeof t)return t;var e={};for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);return e}function arrayContains(t,e){for(var s=t.length;s--;)if(t[s]===e)return!0;return!1}function hexToRgb(t,e){var s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e||(e=1),s?[parseInt(s[1],16)/e,parseInt(s[2],16)/e,parseInt(s[3],16)/e]:null}function arrayUnique(t){return t.filter((function(t,e,s){return s.indexOf(t)===e}))}function copyMatrix(t){for(var e=new Array(t.length),s=0;s<t.length;s++)e[s]=t[s].slice();return e}function stringEscape(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;"};return t.replace(/[&<>]/g,(function(t){return e[t]||t}))}function trans(t,e){return t.replace(/{(\w+)}/g,(function(t,s){return e[s]||"?"}))}function getSVG(t,e,s){return'<svg class="'+s+'"><use xlink:href="'+("/svg/"+e+".svg#"+t)+'"></use></svg>'}function showElem(t){t&&(t.style.display="block")}function hideElem(t){t&&(t.style.display="none")}function htmlEntities(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function toggleElem(t){return"block"===t.style.display?(hideElem(t),!1):(showElem(t),!0)}function selectText(t){window.getSelection().selectAllChildren(t)}function addOption(t,e){var s=document.createElement("option");s.value=e.id,s.innerHTML=stringEscape(e.title),s.dataset.desc=stringEscape(e.description),t.appendChild(s)}function CDN_URL(t){var e="";return"undefined"!=typeof conf_global&&(e=conf_global.cdn),e?("/"!==t[0]&&(t="/"+t),"https://"+e+t):t}function includeScript(t,e){var s=document.head,o=document.createElement("script");o.type="text/javascript",o.src=t,o.onload=o.onreadystatechange=e,s.appendChild(o)}Object.values||(Object.values=t=>Object.keys(t).map((e=>t[e])));var finesse=[[[1,2,1,0,1,2,1],[2,2,2,2,1,1,2,2,2,2],[1,2,1,0,1,2,1],[2,2,2,2,1,1,2,2,2,2]],[[1,2,2,1,0,1,2,2,1],[1,2,2,1,0,1,2,2,1],[1,2,2,1,0,1,2,2,1],[1,2,2,1,0,1,2,2,1]],[[1,2,1,0,1,2,2,1],[2,2,3,2,1,2,3,3,2],[3,4,3,2,3,4,4,3],[2,3,2,1,2,3,3,2,2]],[[1,2,1,0,1,2,2,1],[2,2,3,2,1,2,3,3,2],[3,4,3,2,3,4,4,3],[2,3,2,1,2,3,3,2,2]],[[1,2,1,0,1,2,2,1],[2,2,3,2,1,2,3,3,2],[3,4,3,2,3,4,4,3],[2,3,2,1,2,3,3,2,2]],[[1,2,1,0,1,2,2,1],[2,2,2,1,1,2,3,2,2],[1,2,1,0,1,2,2,1],[2,2,2,1,1,2,3,2,2]],[[1,2,1,0,1,2,2,1],[2,2,2,1,1,2,3,2,2],[1,2,1,0,1,2,2,1],[2,2,2,1,1,2,3,2,2]]];function Block(t){this.id=t,this.set=0,this.pos={x:3,y:0},this.rot=0,this.item=0}function BlockSet(){this.blocks={},this.step=1,this.scale=1,this.items=!1,this.previewAs=null,this.equidist=!0,this.allspin=null}var _blockSets=null;function getBlockSets(){if(null!==_blockSets)return _blockSets;var t=new BlockSet;t.items=!0;var e=[{"-1":[[0,0],[1,0],[1,1],[0,-2],[1,-2]],1:[[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]],2:[[0,0],[0,1]]},{"-1":[[0,0],[1,0],[1,-1],[0,2],[1,2]],1:[[0,0],[1,0],[1,-1],[0,2],[1,2]],2:[[0,0],[1,0]]},{"-1":[[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]],1:[[0,0],[1,0],[1,1],[0,-2],[1,-2]],2:[[0,0],[0,-1]]},{"-1":[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]],1:[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]],2:[[0,0],[-1,0]]}],s=[{"-1":[[0,0],[-1,0],[2,0],[-1,2],[2,-1]],1:[[0,0],[-2,0],[1,0],[-2,-1],[1,2]],2:[[0,0],[0,1]]},{"-1":[[0,0],[2,0],[-1,0],[2,1],[-1,-2]],1:[[0,0],[-1,0],[2,0],[-1,2],[2,-1]],2:[[0,0],[1,0]]},{"-1":[[0,0],[1,0],[-2,0],[1,-2],[-2,1]],1:[[0,0],[2,0],[-1,0],[2,1],[-1,-2]],2:[[0,0],[0,-1]]},{"-1":[[0,0],[-2,0],[1,0],[-2,-1],[1,2]],1:[[0,0],[1,0],[-2,0],[1,-2],[-2,1]],2:[[0,0],[-1,0]]}],o=[{"-1":[[0,0]],1:[[0,0]],2:[[0,0]]},{"-1":[[0,0]],1:[[0,0]],2:[[0,0]]},{"-1":[[0,0]],1:[[0,0]],2:[[0,0]]},{"-1":[[0,0]],1:[[0,0]],2:[[0,0]]}];t.blocks=[{id:0,name:"I",color:5,blocks:[[[0,0,0,0],[1,2,3,4],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,2,0],[0,0,3,0],[0,0,4,0]],[[0,0,0,0],[0,0,0,0],[4,3,2,1],[0,0,0,0]],[[0,4,0,0],[0,3,0,0],[0,2,0,0],[0,1,0,0]]],cc:[0,2,0,1],yp:[1,1],spawn:[3,-1],kicks:s,h:[1,4,1,4]},{id:1,name:"O",color:3,blocks:[[[0,0,0,0],[0,1,2,0],[0,3,4,0],[0,0,0,0]],[[0,0,0,0],[0,3,1,0],[0,4,2,0],[0,0,0,0]],[[0,0,0,0],[0,4,3,0],[0,2,1,0],[0,0,0,0]],[[0,0,0,0],[0,2,4,0],[0,1,3,0],[0,0,0,0]]],cc:[1,1,1,1],yp:[1,2],spawn:[3,-2],kicks:o,h:[2,2,2,2]},{id:2,name:"T",color:7,blocks:[[[0,0,0,0],[0,1,0,0],[2,3,4,0],[0,0,0,0]],[[0,0,0,0],[0,2,0,0],[0,3,1,0],[0,4,0,0]],[[0,0,0,0],[0,0,0,0],[4,3,2,0],[0,1,0,0]],[[0,0,0,0],[0,4,0,0],[1,3,0,0],[0,2,0,0]]],cc:[0,1,0,0],yp:[1,2],spawn:[3,-2],kicks:e,h:[2,3,2,3]},{id:3,name:"L",color:2,blocks:[[[0,0,0,0],[0,0,1,0],[2,3,4,0],[0,0,0,0]],[[0,0,0,0],[0,2,0,0],[0,3,0,0],[0,4,1,0]],[[0,0,0,0],[0,0,0,0],[4,3,2,0],[1,0,0,0]],[[0,0,0,0],[1,4,0,0],[0,3,0,0],[0,2,0,0]]],cc:[0,1,0,0],yp:[1,2],spawn:[3,-2],kicks:e,h:[2,3,2,3]},{id:4,name:"J",color:6,blocks:[[[0,0,0,0],[1,0,0,0],[2,3,4,0],[0,0,0,0]],[[0,0,0,0],[0,2,1,0],[0,3,0,0],[0,4,0,0]],[[0,0,0,0],[0,0,0,0],[4,3,2,0],[0,0,1,0]],[[0,0,0,0],[0,4,0,0],[0,3,0,0],[1,2,0,0]]],cc:[0,1,0,0],yp:[1,2],spawn:[3,-2],kicks:e,h:[2,3,2,3]},{id:5,name:"S",color:4,blocks:[[[0,0,0,0],[0,1,2,0],[3,4,0,0],[0,0,0,0]],[[0,0,0,0],[0,3,0,0],[0,4,1,0],[0,0,2,0]],[[0,0,0,0],[0,0,0,0],[0,4,3,0],[2,1,0,0]],[[0,0,0,0],[2,0,0,0],[1,4,0,0],[0,3,0,0]]],cc:[0,1,0,0],yp:[1,2],spawn:[3,-2],kicks:e,h:[2,3,2,3]},{id:6,name:"Z",color:1,blocks:[[[0,0,0,0],[1,2,0,0],[0,3,4,0],[0,0,0,0]],[[0,0,0,0],[0,0,1,0],[0,3,2,0],[0,4,0,0]],[[0,0,0,0],[0,0,0,0],[4,3,0,0],[0,2,1,0]],[[0,0,0,0],[0,4,0,0],[2,3,0,0],[1,0,0,0]]],cc:[0,1,0,0],yp:[1,2],spawn:[3,-2],kicks:e,h:[2,3,2,3]}],t.allspin=[[[[-1,1,4,1],[[1,0,2,0],[1,2,2,2]]],[[2,-1,2,4],[[1,1,1,2],[3,1,3,2]]],[[-1,2,4,2],[[1,1,2,1],[1,3,2,3]]],[[1,-1,1,4],[[0,1,0,2],[2,1,2,2]]]],null,null,[[[0,3,2,3],[0,1,1,1]],[[0,1,0,3],[2,1,2,2]],[[0,1,2,1],[1,3,2,3]],[[2,1,2,3],[0,2,0,3]]],[[[0,3,2,3],[1,1,2,1]],[[0,1,0,3],[2,2,2,3]],[[0,1,2,1],[0,3,1,3]],[[2,1,2,3],[0,1,0,2]]],[[[3,1,-1,2],[0,1,2,2]],[[1,0,2,4],[2,1,1,3]],[[3,2,-1,3],[0,2,2,3]],[[0,0,1,4],[1,1,0,3]]],[[[-1,1,3,2],[0,2,2,1]],[[2,0,1,4],[1,1,2,3]],[[-1,2,3,3],[2,2,0,3]],[[-1,2,0,4],[0,1,1,3]]]],t.previewAs=t;var i=new BlockSet,c=[{"-1":[[0,0],[1,0],[-1,0]],1:[[0,0],[1,0],[-1,0]],2:[[0,0],[1,0],[-1,0]]},{"-1":[[0,0],[1,0],[-1,0]],1:[[0,0],[1,0],[-1,0]],2:[[0,0],[1,0],[-1,0]]},{"-1":[[0,0],[1,0],[-1,0]],1:[[0,0],[1,0],[-1,0]],2:[[0,0],[1,0],[-1,0]]},{"-1":[[0,0],[1,0],[-1,0]],1:[[0,0],[1,0],[-1,0]],2:[[0,0],[1,0],[-1,0]]}];i.blocks=[{id:200,name:"I",color:1,blocks:[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]]],cc:[0,2,0,1],spawn:[3,-1],kicks:o},{id:201,name:"O",color:3,blocks:[[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]]],cc:[1,1,1,1],spawn:[3,-2],kicks:c},{id:202,name:"T",color:5,blocks:[[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[0,1,0,0],[1,1,1,0],[0,0,0,0]],[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]]],cc:[0,1,0,0],spawn:[3,-2],kicks:c},{id:203,name:"L",color:2,blocks:[[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]],[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[0,0,1,0],[1,1,1,0],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]]],cc:[0,1,0,0],spawn:[3,-2],kicks:c},{id:204,name:"J",color:6,blocks:[[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],[[0,0,0,0],[1,0,0,0],[1,1,1,0],[0,0,0,0]],[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]]],cc:[0,1,0,0],spawn:[3,-2],kicks:c},{id:205,name:"S",color:7,blocks:[[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]]],cc:[0,1,0,0],spawn:[3,-2],kicks:c},{id:206,name:"Z",color:4,blocks:[[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]]],cc:[0,1,0,0],spawn:[3,-2],kicks:c}],i.previewAs=i;var n=new BlockSet;n.previewAs=n,n.equidist=!1,n.blocks=[{id:21,name:"I5",yp:[2,2],xp:0,rp:[2,2],blocks:[[[0,0,0,0,0],[0,0,0,0,0],[1,1,1,1,1],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]],[[0,0,0,0,0],[0,0,0,0,0],[1,1,1,1,1],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]]],spawn:[3,-2],kicks:s,cc:[0,0,0,0],color:5},{id:22,name:"V5",yp:[0,2],xp:0,rp:[1,1],blocks:[[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[1,0,0,0,0],[1,0,0,0,0],[1,1,1,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[1,1,1,0,0],[1,0,0,0,0],[1,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[1,1,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0]]],spawn:[3,-2],kicks:e,cc:[0,0,0,0],color:6},{id:23,name:"T5",yp:[0,2],xp:[1,3],rp:[2,2],blocks:[[[0,0,1,0,0],[0,0,1,0,0],[0,1,1,1,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,0,1,0,0],[0,0,1,1,1],[0,0,1,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,0,0,0,0],[0,1,1,1,0],[0,0,1,0,0],[0,0,1,0,0]],[[0,0,0,0,0],[0,0,1,0,0],[1,1,1,0,0],[0,0,1,0,0],[0,0,0,0,0]]],spawn:[3,-2],kicks:e,cc:[0,0,0,0],color:7},{id:24,name:"U5",yp:[0,1],xp:0,rp:[1,1],blocks:[[[1,0,1,0,0],[1,1,1,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,1,1,0,0],[0,1,0,0,0],[0,1,1,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[1,1,1,0,0],[1,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[1,1,0,0,0],[0,1,0,0,0],[1,1,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]],spawn:[3,-1],kicks:e,cc:[0,0,0,0],color:1},{id:25,name:"W5",yp:[0,2],xp:0,rp:[1,1],blocks:[[[0,0,1,0,0],[0,1,1,0,0],[1,1,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[1,0,0,0,0],[1,1,0,0,0],[0,1,1,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,1,1,0,0],[1,1,0,0,0],[1,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[1,1,0,0,0],[0,1,1,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0]]],spawn:[3,-2],kicks:e,cc:[0,0,0,0],color:2},{id:26,name:"X5",yp:[0,2],xp:0,rp:[1,1],blocks:[[[0,1,0,0,0],[1,1,1,0,0],[0,1,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,1,0,0,0],[1,1,1,0,0],[0,1,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,1,0,0,0],[1,1,1,0,0],[0,1,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,1,0,0,0],[1,1,1,0,0],[0,1,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]],spawn:[3,-2],kicks:e,cc:[0,0,0,0],color:3},{id:27,name:"J5",yp:[1,2],xp:[1,4],rp:[2,2],blocks:[[[0,0,0,0,0],[0,1,0,0,0],[0,1,1,1,1],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,0,1,1,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]],[[0,0,0,0,0],[0,0,0,0,0],[1,1,1,1,0],[0,0,0,1,0],[0,0,0,0,0]],[[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,1,1,0,0],[0,0,0,0,0]]],spawn:[3,-2],kicks:e,cc:[0,0,0,0],color:4},{id:28,name:"L5",yp:[1,2],xp:0,rp:[2,2],blocks:[[[0,0,0,0,0],[0,0,0,1,0],[1,1,1,1,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,1,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,0,0,0,0],[0,1,1,1,1],[0,1,0,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,1,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]]],spawn:[3,-2],kicks:e,cc:[0,0,0,0],color:5},{id:29,name:"S5",yp:[1,2],xp:0,rp:[2,2],blocks:[[[0,0,0,0,0],[0,0,1,1,0],[1,1,1,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,1,0,0],[0,0,1,0,0],[0,0,1,1,0],[0,0,0,1,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,0,0,0,0],[0,0,1,1,1],[0,1,1,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,1,0,0,0],[0,1,1,0,0],[0,0,1,0,0],[0,0,1,0,0]]],spawn:[3,-2],kicks:e,cc:[0,0,0,0],color:6},{id:30,name:"Z5",yp:[1,2],xp:[1,4],rp:[2,2],blocks:[[[0,0,0,0,0],[0,1,1,0,0],[0,0,1,1,1],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,0,0,1,0],[0,0,1,1,0],[0,0,1,0,0],[0,0,1,0,0]],[[0,0,0,0,0],[0,0,0,0,0],[1,1,1,0,0],[0,0,1,1,0],[0,0,0,0,0]],[[0,0,1,0,0],[0,0,1,0,0],[0,1,1,0,0],[0,1,0,0,0],[0,0,0,0,0]]],spawn:[3,-2],kicks:e,cc:[0,0,0,0],color:7},{id:31,name:"TL",yp:[1,2],xp:0,rp:[2,2],blocks:[[[0,0,0,0,0],[0,0,1,0,0],[1,1,1,1,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,1,0,0],[0,0,1,0,0],[0,0,1,1,0],[0,0,1,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,0,0,0,0],[0,1,1,1,1],[0,0,1,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,0,1,0,0],[0,1,1,0,0],[0,0,1,0,0],[0,0,1,0,0]]],spawn:[3,-2],kicks:e,cc:[0,0,0,0],color:1},{id:32,name:"TJ",yp:[1,2],xp:[1,4],rp:[2,2],blocks:[[[0,0,0,0,0],[0,0,1,0,0],[0,1,1,1,1],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[0,0,1,0,0],[0,0,1,1,0],[0,0,1,0,0],[0,0,1,0,0]],[[0,0,0,0,0],[0,0,0,0,0],[1,1,1,1,0],[0,0,1,0,0],[0,0,0,0,0]],[[0,0,1,0,0],[0,0,1,0,0],[0,1,1,0,0],[0,0,1,0,0],[0,0,0,0,0]]],spawn:[3,-2],kicks:e,cc:[0,0,0,0],color:2},{id:33,name:"OZ",yp:[0,1],xp:0,rp:[1,1],blocks:[[[1,1,0,0,0],[1,1,1,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,1,1,0,0],[0,1,1,0,0],[0,1,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[1,1,1,0,0],[0,1,1,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,1,0,0,0],[1,1,0,0,0],[1,1,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]],spawn:[3,-1],kicks:e,cc:[0,0,0,0],color:3},{id:34,name:"OS",yp:[0,1],xp:0,rp:[1,1],blocks:[[[0,1,1,0,0],[1,1,1,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,1,0,0,0],[0,1,1,0,0],[0,1,1,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,0,0,0],[1,1,1,0,0],[1,1,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[1,1,0,0,0],[1,1,0,0,0],[0,1,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]],spawn:[3,-1],kicks:e,cc:[0,0,0,0],color:4},{id:35,name:"TS",yp:[0,2],xp:0,rp:[1,1],blocks:[[[1,0,0,0,0],[1,1,1,0,0],[0,1,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,1,1,0,0],[1,1,0,0,0],[0,1,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,1,0,0,0],[1,1,1,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,1,0,0,0],[0,1,1,0,0],[1,1,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]],spawn:[3,-2],kicks:e,cc:[0,0,0,0],color:5},{id:36,name:"TZ",yp:[0,2],xp:0,rp:[1,1],blocks:[[[0,0,1,0,0],[1,1,1,0,0],[0,1,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,1,0,0,0],[1,1,0,0,0],[0,1,1,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,1,0,0,0],[1,1,1,0,0],[1,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[1,1,0,0,0],[0,1,1,0,0],[0,1,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]],spawn:[3,-2],kicks:e,cc:[0,0,0,0],color:6},{id:37,name:"LL",yp:[0,2],xp:0,rp:[1,1],blocks:[[[0,0,1,0,0],[1,1,1,0,0],[1,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[1,1,0,0,0],[0,1,0,0,0],[0,1,1,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,0,1,0,0],[1,1,1,0,0],[1,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[1,1,0,0,0],[0,1,0,0,0],[0,1,1,0,0],[0,0,0,0,0],[0,0,0,0,0]]],spawn:[3,-2],kicks:e,cc:[0,0,0,0],color:7},{id:38,name:"JJ",yp:[0,2],xp:0,rp:[1,1],blocks:[[[1,0,0,0,0],[1,1,1,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,1,1,0,0],[0,1,0,0,0],[1,1,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[1,0,0,0,0],[1,1,1,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0]],[[0,1,1,0,0],[0,1,0,0,0],[1,1,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]],spawn:[3,-2],kicks:e,cc:[0,0,0,0],color:1}];var r=new BlockSet;r.items=!0,r.previewAs=r,r.equidist=!1,r.blocks=[{id:40,name:"I1",yp:[0,0],blocks:[[[1]],[[1]],[[1]],[[1]]],spawn:[4,0],kicks:e,cc:[0,0,0,0],color:1},{id:41,name:"I2",yp:[0,0],blocks:[[[1,2],[0,0]],[[0,1],[0,2]],[[0,0],[2,1]],[[2,0],[1,0]]],spawn:[4,0],kicks:e,cc:[0,0,0,0],color:2},{id:42,name:"I3",yp:[1,1],blocks:[[[0,0,0],[1,2,3],[0,0,0]],[[0,1,0],[0,2,0],[0,3,0]],[[0,0,0],[3,2,1],[0,0,0]],[[0,3,0],[0,2,0],[0,1,0]]],spawn:[3,-1],kicks:e,cc:[0,0,0,0],color:3},{id:43,name:"L3",yp:[0,1],blocks:[[[1,0,0],[2,3,0],[0,0,0]],[[2,1,0],[3,0,0],[0,0,0]],[[3,2,0],[0,1,0],[0,0,0]],[[0,3,0],[1,2,0],[0,0,0]]],spawn:[4,-1],kicks:e,cc:[0,0,0,0],color:4}];var a=new BlockSet;a.previewAs=a,a.equidist=!1,a.blocks=t.blocks.slice().concat(r.blocks.slice()).concat(n.blocks.slice());var l=new BlockSet;for(var h in l.blocks=[],l.previewAs=l,t.blocks)l.blocks.push(objCopy(t.blocks[h]));var p=[[0,0],[-1,0],[1,0],[0,-1],[-1,-1],[1,-1],[-2,0],[2,0]],k={"-1":p,1:p,2:p},d=[k,k,k,k];for(var h in l.blocks)l.blocks[h].kicks=d;var u=new BlockSet;u.previewAs=u,u.blocks=[];var b=[[0,0],[-1,0],[1,0],[0,-1],[-1,-1],[1,-1],[-2,0],[2,0],[0,-2],[-1,-2],[1,-2],[0,1],[-2,-2],[2,-2],[-3,-3],[3,-3]],v={"-1":b,1:b,2:b},f=[v,v,v,v],w=[[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]],[[0,0,0,0],[1,0,0,0],[1,1,0,0],[1,0,0,0]],[[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]]];for(var h in t.blocks)u.blocks.push(objCopy(t.blocks[h])),u.blocks[h].kicks=f,"O"===u.blocks[h].name&&(u.blocks[h].name="O+",u.blocks[h].id=50,u.blocks[h].blocks=w);var m=new BlockSet;m.previewAs=m,m.equidist=!1,m.blocks=[{id:400,name:"I1",yp:[0,0],blocks:[[[0]],[[0]],[[0]],[[0]]],spawn:[4,-1],kicks:e,cc:[0,0,0,0],color:9}];var y=new BlockSet;function g(t,e,s,o){e>=t.length&&(t[e]=[]),t[e][s]=o}function A(t,e){for(var s=0;s<t.length;s++)t[s][0]*=e,t[s][1]*=e}function E(e){var s=new BlockSet;s.blocks=JSON.parse(JSON.stringify(t.blocks));for(var o=t.blocks,i=0;i<o.length;i++){for(var c=0;c<4;c++)for(var n=o[i].blocks[c],r=0;r<4;r++)for(var a=0;a<4;a++){var l=n[r][a];g(s.blocks[i].blocks[c],r*e,a*e,l),g(s.blocks[i].blocks[c],r*e+1,a*e,l),g(s.blocks[i].blocks[c],r*e,a*e+1,l),g(s.blocks[i].blocks[c],r*e+1,a*e+1,l)}for(var h in s.blocks[i].kicks)A(s.blocks[i].kicks[h][-1],e),A(s.blocks[i].kicks[h][1],e),A(s.blocks[i].kicks[h][2],e);s.blocks[i].spawn[0]=2===e?2:1,s.blocks[i].id+=100}return s.scale=2,s.step=2,s.previewAs=t,s}y.items=!0,y.previewAs=m,y.equidist=!1,y.ghost=!1,y.blocks=[{id:401,name:"INV",yp:[0,0],blocks:[[[1]],[[1]],[[1]],[[1]]],spawn:[4,-1],kicks:e,cc:[0,0,0,0],color:9}];var S=E(2),x=E(2);return x.step=1,_blockSets=[t,S,x,i,n,r,a,l,u,y]}function Scoring(){this.A=Object.freeze({SOFT_DROP:0,HARD_DROP:1,CLEAR1:2,CLEAR2:3,CLEAR3:4,CLEAR4:5,TSPIN_MINI:6,TSPIN:7,TSPIN_MINI_SINGLE:8,TSPIN_SINGLE:9,TSPIN_DOUBLE:10,TSPIN_TRIPLE:11,PERFECT_CLEAR:12,COMBO:13,CLEAR5:14}),this.ATI=[-1,-1,1,2,3,4,-1,-1,8,7,5,6,9,-1,6],this.S=Array(15),this.S[this.A.SOFT_DROP]=1,this.S[this.A.HARD_DROP]=2,this.S[this.A.CLEAR1]=100,this.S[this.A.CLEAR2]=300,this.S[this.A.CLEAR3]=500,this.S[this.A.CLEAR4]=800,this.S[this.A.CLEAR5]=1600,this.S[this.A.TSPIN_MINI]=100,this.S[this.A.TSPIN]=400,this.S[this.A.TSPIN_MINI_SINGLE]=200,this.S[this.A.TSPIN_SINGLE]=800,this.S[this.A.TSPIN_DOUBLE]=1200,this.S[this.A.TSPIN_TRIPLE]=1600,this.S[this.A.PERFECT_CLEAR]=3e3,this.S[this.A.COMBO]=50,this.B2B=Array(15),this.B2B[this.A.CLEAR4]=400,this.B2B[this.A.CLEAR5]=800,this.B2B[this.A.TSPIN_MINI_SINGLE]=100,this.B2B[this.A.TSPIN_SINGLE]=400,this.B2B[this.A.TSPIN_DOUBLE]=600,this.B2B[this.A.TSPIN_TRIPLE]=800}Scoring.prototype.get=function(t,e){var s=this.S[t];return void 0!==e&&!0===e&&void 0!==this.B2B[t]&&(s+=this.B2B[t]),s},Scoring.prototype.lineAtk=function(t,e,s){if(t===this.A.COMBO)return s.getComboAttack(e);let o=this.ATI[t],i=0;return o&&-1!=o&&(i=s.linesAttack[o]),this.B2B[t]&&s.wasBack2Back&&(i+=s.linesAttack[10]),i},window.Score=new Scoring;var Action=Object.freeze({MOVE_LEFT:0,MOVE_RIGHT:1,DAS_LEFT:2,DAS_RIGHT:3,ROTATE_LEFT:4,ROTATE_RIGHT:5,ROTATE_180:6,HARD_DROP:7,SOFT_DROP_BEGIN_END:8,GRAVITY_STEP:9,HOLD_BLOCK:10,GARBAGE_ADD:11,SGARBAGE_ADD:12,REDBAR_SET:13,ARR_MOVE:14,AUX:15}),Aux=Object.freeze({AFK:0,BLOCK_SET:1,MOVE_TO:2,RANDOMIZER:3,MATRIX_MOD:4,WIDE_GARBAGE_ADD:5});function Map(){this.block_size=24,this.skinId=0,this.color=1,this.MAX_ALLOWED_COLOR=8,this.cids=[0,1,2,3,4,5,6,7,8,9,10,11],this.coffset=[0,2,3,4,5,6,7,8,1,0],this.colors=["black","#D70F37","#E35B02","#E39F02","#59B101","#0F9BD7","#2141C6","#AF298A","#999999","#6A6A6A","black","white"],this.NullCol=["black","#E4203E","#E47E30","#E3CF3C","#1DE03D","#00C9DF","#0042DC","#9E2CDC","#999999","#585858","black","white"],this.matrix=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],this.mouseDown=!1,this.downBlock=null,this.moveChanges=0,this.CPRect=22,this.CPRectBorder=5}Map.prototype.mapPreview=function(t){this.canvas=document.createElement("canvas"),void 0!==t.dataset.width?this.canvas.width=parseInt(t.dataset.width):this.canvas.width=40,this.block_size=Math.round(this.canvas.width/10),this.canvas.height=2*this.canvas.width,this.canvas.style.backgroundColor="black",this.ctx=this.canvas.getContext("2d");var e=t.dataset.map;t.appendChild(this.canvas),this.parseMap(e),this.redraw()},Map.prototype.setupMapCreator=function(){this.canvas=document.getElementById("myCanvas"),this.ctx=this.canvas.getContext("2d"),this.bgCanvas=document.getElementById("bgLayer"),this.bgctx=this.bgCanvas.getContext("2d"),this.cCanvas=document.getElementById("colorCanvas"),this.cctx=this.cCanvas.getContext("2d"),this.mapData=document.getElementById("mapData"),this.queueEdit=document.getElementById("queueEdit")},Map.prototype.parseMap=function(t){for(var e=base64ToBinary(t),s=0;s<e.length;s++){var o=Math.floor(s/5),i=2*(s-5*o);this.matrix[o][i]=e[s]>>>4,this.matrix[o][i+1]=15&e[s]}},Map.prototype.init=function(){this.drawBgGrid(),this.redrawColorPicker(),this.mapData.value&&(this.parseMap(this.mapData.value),this.redraw()),this.queueEdit.value&&(document.getElementById("queueRad2").checked=!0),this.queueOptChange()},Map.prototype.redraw=function(){for(var t=0;t<20;t++)for(var e=0;e<10;e++)this.drawBlock(e,t,this.matrix[t][e])},Map.prototype.redrawColorPicker=function(){this.cctx.clearRect(0,0,this.cCanvas.width,this.cCanvas.height);for(var t=0;t<=8;t++){var e=this.CPRectBorder+t*(this.CPRect+2*this.CPRectBorder);this.cctx.beginPath(),this.cctx.rect(5,e,this.CPRect,this.CPRect),this.cctx.fillStyle=this.colors[t],this.cctx.fill(),t===this.color&&(this.cctx.lineWidth=this.CPRectBorder-2,this.cctx.strokeStyle="white",this.cctx.stroke())}},Map.prototype.drawBgGrid=function(){this.bgctx.rect(0,0,this.canvas.width,this.canvas.height),this.bgctx.fillStyle="#000000",this.bgctx.fill(),this.bgctx.beginPath(),this.bgctx.lineWidth=1;for(var t=1;t<10;t++)this.bgctx.moveTo(t*this.block_size+.5,0),this.bgctx.lineTo(t*this.block_size+.5,this.canvas.height);for(t=1;t<20;t++)this.bgctx.moveTo(0,t*this.block_size+.5),this.bgctx.lineTo(240,t*this.block_size+.5);this.bgctx.strokeStyle="#101010",this.bgctx.stroke(),this.bgctx.beginPath();for(t=0;t<9;t++)for(var e=1;e<20;e++)this.bgctx.moveTo(t*this.block_size+.75*this.block_size,e*this.block_size+.5),this.bgctx.lineTo((t+1)*this.block_size+.2*this.block_size,e*this.block_size+.5);for(t=0;t<19;t++)for(var s=1;s<10;s++)this.bgctx.moveTo(s*this.block_size+.5,t*this.block_size+.75*this.block_size),this.bgctx.lineTo(s*this.block_size+.5,(t+1)*this.block_size+.2*this.block_size);this.bgctx.strokeStyle="#202020",this.bgctx.stroke(),this.bgctx.beginPath(),this.bgctx.strokeStyle="#393939",this.bgctx.stroke()},Map.prototype.exportMap=function(){for(var t=new ArrayBuffer(100),e=new Uint8Array(t),s=0,o=0;o<20;o++)for(var i=0;i<10;i++){var c=s%2==0,n=Math.floor(s/2);c&&(e[n]=0),e[n]|=(15&this.matrix[o][i])<<(c?4:0),s++}this.mapData.value=_simpleArrayBufferToBase64(t)},Map.prototype.CPmousedown=function(t){var e=this.getMousePos(this.cCanvas,t);this.color=Math.floor((e.y-this.CPRectBorder)/(this.CPRect+2*this.CPRectBorder)),this.color>this.MAX_ALLOWED_COLOR&&(this.color=1),this.redrawColorPicker()},Map.prototype.onMouseEvent=function(t,e){var s=this.convertToBlock(t,e);this.moveChanges+=this.changeBlockToColor(s,this.color)},Map.prototype.changeBlockToColor=function(t,e){return t.x<0||t.y<0||t.x>9||t.y>19||this.matrix[t.y][t.x]===e?0:(this.drawBlock(t.x,t.y,e),this.matrix[t.y][t.x]=e,this.exportMap(),1)},Map.prototype.mousedown=function(t){this.mouseDown=!0,this.moveChanges=0;var e=this.getMousePos(this.canvas,t);this.downBlock=this.convertToBlock(e.x,e.y),this.onMouseEvent(e.x,e.y)},Map.prototype.mouseup=function(t){this.mouseDown=!1;var e=this.getMousePos(this.canvas,t),s=this.convertToBlock(e.x,e.y);this.downBlock&&s.x===this.downBlock.x&&s.y===this.downBlock.y&&this.matrix[s.y][s.x]&&!this.moveChanges&&this.changeBlockToColor(s,0)},Map.prototype.mousemove=function(t){if(this.mouseDown){var e=this.getMousePos(this.canvas,t);this.onMouseEvent(e.x,e.y)}},Map.prototype.getMousePos=function(t,e){var s=t.getBoundingClientRect();return{x:e.clientX-s.left,y:e.clientY-s.top}},Map.prototype.convertToBlock=function(t,e){return{x:Math.ceil(t/this.block_size)-1,y:Math.ceil(e/this.block_size)-1}},Map.prototype.drawBlock=function(t,e,s){s&&t>=0&&e>=0&&t<10&&e<20&&this.drawRectangle(this.ctx,t*this.block_size,e*this.block_size,this.block_size,this.block_size,this.colors[s]),0===s&&this.ctx.clearRect(t*this.block_size,e*this.block_size,this.block_size,this.block_size)},Map.prototype.queueChange=function(){var t=this.queueEdit.value.toUpperCase().replace(/[^SZLJOIT]/gi,"");this.queueEdit.value=t},Map.prototype.queueOptChange=function(){document.getElementById("queueRad2").checked?showElem(this.queueEdit):(hideElem(this.queueEdit),this.queueEdit.value="")},Map.prototype.drawRectangle=function(t,e,s,o,i,c){t.beginPath(),t.rect(e,s,o,i),t.fillStyle=c,t.fill()};